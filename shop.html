<!DOCTYPE html>
<html>
<head>
<title>Mecknown Shop</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
</head>

<body>

<section class="section">
<h2>Mecknown Store</h2>

<div id="loginSection">
<button onclick="googleLogin()">Sign in with Google</button>
</div>

<div id="shopSection" style="display:none;">
<p id="userInfo"></p>
<div class="shop-grid" id="productContainer"></div>
<button onclick="logout()">Logout</button>
</div>

</section>

<script>

/* Firebase Config */
const firebaseConfig = {
  apiKey: "AIzaSyDyh1Bi_29TpEG-_N3QijtxB7rdjLdHy3M",
  authDomain: "mecknownshop.firebaseapp.com",
  projectId: "mecknownshop"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

function googleLogin(){
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider);
}

auth.onAuthStateChanged(user => {
  if(user){
    document.getElementById("loginSection").style.display="none";
    document.getElementById("shopSection").style.display="block";
    document.getElementById("userInfo").innerText="Logged in as: "+user.email;
    loadProducts();
  }
});

function logout(){
  auth.signOut();
  location.reload();
}

/* Load Products */
function loadProducts(){
  fetch("products.json")
  .then(res=>res.json())
  .then(data=>{
    const container=document.getElementById("productContainer");
    container.innerHTML="";

    data.forEach(product=>{
      container.innerHTML+=`
        <div class="product-card">
          <img src="${product.image}">
          <h3>${product.name}</h3>
          <p>${product.description}</p>
          <div class="price">â‚¹${product.price}</div>
          <button class="buy-btn" onclick="placeOrder('${product.name}', '${product.price}')">
            Buy Now
          </button>
        </div>
      `;
    });
  });
}

/* Send Order */
function placeOrder(name, price){

  const user=auth.currentUser;

  const formData=new FormData();
  formData.append("email", user.email);
  formData.append("product", name);
  formData.append("price", price);

  fetch("https://script.google.com/macros/s/AKfycbxBF5aO2yATBlOWeWatWSWM_wlSk0i13DEBbRCtcUO5vYpwM6oH89BbwSrVzl1VVfR2kQ/execL",{
    method:"POST",
    body:formData
  })
  .then(()=>alert("Order placed!"))
  .catch(()=>alert("Order failed"));

}

</script>

</body>
</html>
